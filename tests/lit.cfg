# -*- Python -*-
import lit.formats
from lit.llvm import llvm_config

config.name = 'libledmtx'

config.test_format = lit.formats.ShTest(not llvm_config.use_lit_shell)

config.suffixes = ['.S', '.c']
config.excludes = []
config.test_source_root = config.ledmtx_test_dir
config.test_exec_root = config.ledmtx_test_dir

config.substitutions += [
    ('%gpasm', 'gpasm'),
    ('%gplink', 'gplink'),
    ('%gpsim', 'gpsim'),
    ('%ledmtx_test_dir', config.ledmtx_test_dir),
    ('%ledmtx_src_dir', config.ledmtx_src_dir),
    ('%ASFLAGS', '-p 18f452 -I' + config.ledmtx_src_dir + '/../include -I' + config.ledmtx_src_dir),
    ('%GPLINKFLAGS', '-O2 ' + ' '.join(['-I%s' % I for I in config.sdcc_dirs['libdir']])),
    ('%LDFLAGS', '-mpic16 -p18f452 --use-non-free -Wl-m -L' + config.ledmtx_src_dir + '/core -l libc18f.lib -l libledmtx_core.lib'),
    ('%CFLAGS', '-mpic16 -p18f452 --fomit-frame-pointer --pstack-model=small --use-non-free -I' + config.ledmtx_src_dir + '/../include'),
]
